(function(e,t,n,r){"use strict";if(!history.pushState)return;var i=e("html, body"),s=t.console||false,o={anchors:"a",prefetch:false,blacklist:".no-smoothstate, [target]",development:false,pageCacheSize:0,alterRequestUrl:function(e){return e},onStart:{duration:0,render:function(e,t){i.scrollTop(0)}},onProgress:{duration:0,render:function(e,t){i.css("cursor","wait");i.find("a").css("cursor","wait")}},onEnd:{duration:0,render:function(e,t,n){i.css("cursor","auto");i.find("a").css("cursor","auto");t.html(n)}},callback:function(e,t,n){}},u={isExternal:function(e){var n=e.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof n[1]==="string"&&n[1].length>0&&n[1].toLowerCase()!==t.location.protocol){return true}if(typeof n[2]==="string"&&n[2].length>0&&n[2].replace(new RegExp(":("+{"http:":80,"https:":443}[t.location.protocol]+")?$"),"")!==t.location.host){return true}return false},isHash:function(e){var n=e.indexOf(t.location.pathname)>0?true:false,r=e.indexOf("#")>0?true:false;return n&&r?true:false},shouldLoad:function(e,t){var n=e.prop("href");return!u.isExternal(n)&&!u.isHash(n)&&!e.is(t)},htmlDoc:function(t){var n,r=e(),i=/<(\/?)(html|head|body|title|base|meta)(\s+[^>]*)?>/ig,s="ss"+Math.round(Math.random()*1e5),o=t.replace(i,function(t,n,i,o){var u={};if(!n){e.merge(r,e("<"+i+"/>"));if(o){e.each(e("<div"+o+"/>")[0].attributes,function(e,t){u[t.name]=t.value})}r.eq(-1).attr(u)}return"<"+n+"div"+(n?"":" id='"+s+(r.length-1)+"'")+">"});if(!r.length){return e(t)}if(!n){n=e("<div/>")}n.html(o);e.each(r,function(e){var t=n.find("#"+s+e).before(r[e]);r.eq(e).html(t.contents());t.remove()});return n.children().unwrap()},clearIfOverCapacity:function(e,t){if(!Object.keys){Object.keys=function(e){var t=[],n;for(n in e){if(Object.prototype.hasOwnProperty.call(e,n)){t.push(n)}}return t}}if(Object.keys(e).length>t){e={}}return e},getContentById:function(t,n){n=n instanceof jQuery?n:u.htmlDoc(n);var r=n.find(t),i=r.length?e.trim(r.html()):n.filter(t).html(),s=i.length?e(i):null;return s},storePageIn:function(e,t,n){n=n instanceof jQuery?n:u.htmlDoc(n);e[t]={status:"loaded",title:n.find("title").text(),html:n};return e},triggerAllAnimationEndEvent:function(t,n){n=" "+n||"";var r=0,i="animationstart webkitAnimationStart oanimationstart MSAnimationStart",s="animationend webkitAnimationEnd oanimationend MSAnimationEnd",o="allanimationend",a=function(n){if(e(n.delegateTarget).is(t)){n.stopPropagation();r++}},f=function(n){if(e(n.delegateTarget).is(t)){n.stopPropagation();r--;if(r===0){t.trigger(o)}}};t.on(i,a);t.on(s,f);t.on("allanimationend"+n,function(){r=0;u.redraw(t)})},redraw:function(e){e.height(0);setTimeout(function(){e.height("auto")},0)}},a=function(n){if(n.state!==null){var r=t.location.href,i=e("#"+n.state.id),s=i.data("smoothState");if(s.href!==r&&!u.isHash(r)){s.load(r,true)}}},f=function(r,i){var a=e(r),f={},l=t.location.href,c=function(e,n){n=n||false;var r=false,s=false,o={loaded:function(){var i=r?"ss.onProgressEnd":"ss.onStartEnd";if(!s||!r){a.one(i,function(){h(e)})}else if(s){h(e)}if(!n){t.history.pushState({id:a.prop("id")},f[e].title,e)}},fetching:function(){if(!r){r=true;a.one("ss.onStartEnd",function(){i.onProgress.render(e,a,null);setTimeout(function(){a.trigger("ss.onProgressEnd");s=true},i.onStart.duration)})}setTimeout(function(){if(f.hasOwnProperty(e)){o[f[e].status]()}},10)},error:function(){t.location=e}};if(!f.hasOwnProperty(e)){p(e)}i.onStart.render(e,a,null);setTimeout(function(){a.trigger("ss.onStartEnd")},i.onStart.duration);o[f[e].status]()},h=function(e){var r="#"+a.prop("id"),o=f[e]?u.getContentById(r,f[e].html):null;if(o){n.title=f[e].title;a.data("smoothState").href=e;i.onEnd.render(e,a,o);a.one("ss.onEndEnd",function(){i.callback(e,a,o)});setTimeout(function(){a.trigger("ss.onEndEnd")},i.onEnd.duration)}else if(!o&&i.development&&s){s.warn("No element with an id of "+r+" in response from "+e+" in "+f)}else{t.location=e}},p=function(t){if(f.hasOwnProperty(t)){return}f=u.clearIfOverCapacity(f,i.pageCacheSize);f[t]={status:"fetching"};var n=i.alterRequestUrl(t)||t,r=e.ajax(n);r.success(function(e){u.storePageIn(f,t,e);a.data("smoothState").cache=f});r.error(function(){f[t].status="error"})},d=function(t){var n=e(t.currentTarget),r=n.prop("href");if(u.shouldLoad(n,i.blacklist)){t.stopPropagation();p(r)}},v=function(t){var n=e(t.currentTarget),r=n.prop("href");if(!t.metaKey&&!t.ctrlKey&&u.shouldLoad(n,i.blacklist)){t.stopPropagation();t.preventDefault();c(r)}},m=function(e){e.on("click",i.anchors,v);if(i.prefetch){e.on("mouseover touchstart",i.anchors,d)}},g=function(e){var t=a.addClass(e).prop("class");a.removeClass(t);setTimeout(function(){a.addClass(t)},0);a.one("ss.onStartEnd ss.onProgressEnd ss.onEndEnd",function(){a.removeClass(e)})};i=e.extend(o,i);if(t.history.state===null){t.history.replaceState({id:a.prop("id")},n.title,l)}u.storePageIn(f,l,n.documentElement.outerHTML);u.triggerAllAnimationEndEvent(a,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd");m(a);return{href:l,cache:f,load:c,fetch:p,toggleAnimationClass:g}},l=function(t){return this.each(function(){if(this.id&&!e.data(this,"smoothState")){e.data(this,"smoothState",new f(this,t))}else if(!this.id&&s){s.warn("Every smoothState container needs an id but the following one does not have one:",this)}})};t.onpopstate=a;e.smoothStateUtility=u;e.fn.smoothState=l})(jQuery,window,document)